include: "*.view.lkml"         # include all views in this project

include: "webassign.dims.model.lkml"

explore: datascience_raw {}

explore: sections_students_assignments {
  extends: [dim_question]
  extension: required
  from: dim_section
  view_name: dim_section
  #sql_always_where: ${dim_textbook.code} in ('SCalcET8', 'SCalc8')--, 'SCalcET7', 'SCalc7')
  #                    --and ${dim_section.start_date_raw} >= dateadd(month, -6, current_timestamp());;
  sql_always_where: ${dim_section.section_id} in (703478,702326,702154,691325,703870,700780,705150,705717,675470,691108,691814,690970,672382,696744,697769,667149,704862,701155,673957,699575,671376,667170,703854,672963,672965,672390,700950,699625,666886,668955,704369,662011,683145,702446,675469,689780,696357,704943,664909,693539,672956,673012,696649,702336,699052,691947,694287,697637,672975,681878,692249,697749,659728,695862,662710,705734,666429,670521,666425,696581,698844,710626,686757,673274,671842,672073,707311,672670,674190,680011,684362,684482,662871,679004,668539,706818,664907,664914,665359,673213,682692,675586,678073,672006,668951,668954,672723,661830,672760,677193,677701,677845,677938,676486,685285,685291,669281,684887,678381,676687,659866,682819,669062,680926,675695,662154,673666,658731,664758,675040,654421,668175,682909,681477,672564,678578,667877,667889,667892,667912,665697,681522,674222,676761,680636,680652,672800,674380,685849,672103,667455,665847,665864,676871,668568,662578,670985,672755,668887,680286,661083,699314,694366,676491,673630,673640,673673,668537,667953,668128,675762,663837,673361,668735,684748,673218,681725,666473,697271,673372,679966,699636,699007,703510,701599,666188,702004,694583,699643,681937,667958,683074,700767,706288,658729,703479,669276,691946,690355,698582,674047,674100,673796,677024,693675,672958,672983,672984,701600,681873,668979,691479,704462,704815,670788,708081,697628,692056,681947,681011,696307,696359,672995,700705,674643,677698,691146,691321,684146,676299,693979,680420,663733,689270,672251,680613,666393,666413,667851,688373,685684,685702,710405,685822,691553,672054,665609,689337,703014,679703,679704,680086,684562,668972,666049,663907,684694,668187,696318,705899,676051,665030,675126,675162,675430,678055,678166,694507,702323,680172,679052,677984,684907,678874,678880,678894,680050,677913,677939,680260,685283,681993,662436,674350,675851,669923,680947,664492,664637,673707,682406,678481,700234,682534,682670,659293,659349,672799,661137,660874,667763,667866,667867,667873,667917,665706,665708,680331,660729,681400,680681,699280,667764,674258,670233,679276,672173,665804,665808,665829,665844,665861,665867,684022,671003,661606,672750,680288,676045,667114,694310,676510,662630,667945,667963,668023,668082,669800,675729,665909,659870,673014,673374,674682,679333,669484,702332,701661,697374,697444,690997,691134,693698,695578,666166,686833,698142,679564,695585,691085,666426,691531,691615,702575,706220,695927,689336,695983,696391,697639,673221,671895,672067,665607,695539,672583,689335,676175,679676,679786,680162,684239,677986,678061,673790,672947,698747,701637,708434,701598,693986,700196,686630,671838,671985,701753,697274,695955,684489,679701,680027,684368,703355,663170,666711,695065,674814,675306,665647,665668,679706,704601,684202,673866,669035,679066,678057,669605,669321,673956,677428,660365,676874,666624,667172,705062,674009,674046,672967,678703,661988,662050,683105,678835,678908,699101,661135,678349,677441,677803,681303,672473,685259,680913,669350,678416,680951,680953,680975,674605,683197,680974,664708,668181,703688,672871,672906,673495,680324,665696,660900,667891,667902,665699,666840,674191,674225,680615,701033,680952,682818,659292,683521,667366,667427,676258,666124,665796,665806,684026,672508,676529,680270,680272,670220,681614,672249,673642,667925,684823,668063,670678,669129,677009,675718,668519,668878,673219,673259,671342,693535,695281,671008,707030,702118,702484,701624,690032,691616,691086,658183,698625,675889,703849,691656,702120,693283,672447,703266,701683,672387,694603,692885,672950,672964,672968,672972,672974,703468,693241,693796,676230,683187,691336,672070,666620,673011,673873,693944,694736,695583,699869,672076,678691,682958,668263,673273,683050,674147,683718,696590,683024,695762,699088,703046,673791,679380,697904,694546,703436,676877,685763,670574,661937,685606,671945,671384,665644,672635,707056,662410,679949,680161,679176,674613,683282,662732,662793,663156,671534,665258,675026,675063,675583,675598,684157,677981,678068,678069,679771,684401,684604,662727,674810,678434,678826,680185,669554,677720,677899,684963,685184,691965,669884,680949,673710,685201,675030,673157,665695,669572,682961,672863,667842,667870,667875,667883,667907,667920,665701,666816,674525,680515,680674,667921,677042,668111,670250,672145,676252,662849,683477,665801,684833,680273,672449,674609,680327,680334,670990,672533,670125,670181,672256,684846,667949,667954,667959,668101,673675,665908,673411,683533,683583,679465,695675,700683,694272,703621,697526,697129,691241,704388,704629,693212,695876,696193,681948,697012,667948,700134,701296,703710,699238,674604,685096,667180,709418,698456,681031,691466,672948,672962,702447,695964,702062,692197,697525,690973,671404,689423,672973,672085,681877,676207,680123,704755,683158,673941,694753,697273,683127,682892,699146,673807,678153,666134,683700,685765,663905,702324,706050,672060,672065,676942,689341,672512,679614,679833,679834,679973,677715,680605,680958,668974,661814,666756,708412,680742,680772,665297,670058,671328,678177,677989,678060,678063,673267,671986,665648,679699,684573,670103,678072,667516,666059,674364,678562,682568,676670,690348,677210,677900,663904,674334,680938,664480,664496,664713,664295,664297,669660,682405,682824,672155,672798,672864,681441,667838,667848,667908,665688,665690,671643,674219,681351,674404,674428,667915,665841,665862,684070,672442,668180,672978,698971,676505,676541,676495,669053,667923,671394,673311,683498,684670,673201,673222,666471,663500,700439,703076,696305,701978,698951,699637,694734,671690,689288,691842,702138,692699,697009,690009,663602,663605,663681,692296,708406,698916,704366,705520,697721,700204,702794,697180,686608,677851,699323,665662,673268,696360,696851,674159,679705,684280,676044,694850,675435,698335,691088,664446,694998,704848,704760,698975,700934,697835,672003,696361,672587,679612,663330,679085,664908,692992,683775,661805,677976,675472,701605,693527,698754,693334,695584,706598,686752,684363,677990,662960,696196,677952,671535,675163,677995,662133,664068,678848,678913,685284,682014,660894,677306,677778,677779,677936,685186,678384,667446,660202,683926,681065,681167,681170,681243,680393,673893,673950,672960,672086,674303,665907,678707,680611,668089,667351,666142,665854,665869,676820,680954,680599,698441,661357,661869,680314,664101,684150,671144,676494,676507,676523,673628,673633,673676,668011,668085,668177,683704,671238,672522,673373,675709,669919,664577,664640,673705,676718,664357,680590,682583,682960,674376,667839,667872,667886,674436,676771,680558,667843,667903,683507,673276,679514,681749,697272,697631,697377,696383,691811,681944,699951,701881,704007,690477,691552,699290,697268,698704,701930,684044,666619,703819,706197,707258,660043,690949,672441,693517,681073,697761,674124,702418,697256,666505,691481,703458,694580,697431,691089,683392,696066,673878,682063,672959,674680,678696,668105,683091,690971,665184,664141,671729,671658,666160,685635,707799,676873,704735,708277,671839,665604,665606,689339,679697,679720,679944,679097,668981,662751,699221,671490,678999,668968,665422,675549,678074,678176,703680,701644,665649,684331,650529,711309,679661,676040,665599,665600,670882,675070,675137,675441,678269,664091,702975,683786,668261,683371,677067,677716,677817,671065,669282,669344,669400,669401,683844,667844,668176,680914,683621,683448,664296,676738,682539,682709,682913,659558,672905,678483,673228,667868,667879,667885,667890,670601,665700,665705,665710,665763,681570,680614,696350,664709,680612,670694,680383,665798,665807,665803,665840,665846,680906,677375,680222,680271,680350,680364,667136,683991,670240,676500,667955,668107,668127,683711,671312,673309,668498,673216,679510,661815,687554,691688,676271,691949,672985,706135,667723,689782,673771,700644,663672,707189,694253,689342,685599,696414,663504,707876,675461,685095,681924,690372,702306,671840,704756,673310,694343,662973,666702,675375,678254,697627,699252,685725,685746,710302,705254,706705,683608,676143,684619,668912,676043,664911,673365,674817,677985,668973,683275,700987,671513,675440,677979,668179,684832,667337,667432,673530,665858,683985,672469,672506,675865,678710,680285,664002,672712,683789,669566,677356,685449,678431,673693,663891,672245,670216,676501,676502,673639,668136,668146,668193,675207,674038,674141,672952,672992,672079,681788,676154,673942,669143,674343,664289,682637,657765,672796,678530,673985,667734,667841,667847,667869,667898,665704,665707,681361,681503,674505,666995,680618,680671,676139,668675,673278,679414,666493,703446,697638,697275,700863,700640,673776,691893,678450,689460,686306,670257,698300,692565,695521,688145,703580,696013,685748,699465,699067,700545,701739,671333,671368,702309,702325,673269,668977,683265,697255,666717,668947,674951,675485,671286,690977,696912,708108,666454,699403,668886,686651,706052,673207,679619,679700,681348,695520,668970,666729,678992,694737,706218,675305,678009,678064,704198,699955,686145,704225,646088,674785,684480,708483,677575,679565,684908,672388,667106,681215,667950,674564,666604,672333,674058,674111,670974,677417,683071,670863,672711,678803,683301,682227,677416,677719,680291,683849,684879,665922,665812,669844,680827,680963,680957,676712,676716,664270,682530,682802,672827,674359,683819,667761,667831,667840,667845,667884,667900,674546,702962,683287,667357,703429,666119,666120,665809,665856,665866,683932,672507,668186,670958,671023,670218,670219,676498,673629,665912,667961,668139,683002,669091,665911,673443,673447,668693,673198,679348,679245,679524,681940,703241,696841,695005,695961,693768,689779,673763,666161,694503,692226,677751,692679,703337,697110,705058,693455,703750,702308,699691,687078,696356,672884,702155,668993,693498,665015,674533,691127,694031,697270,689340,689809,664860,704572,697518,695249,699661,695156,706604,686839,662856,668982,674150,665830,679674,674059,684863,664318,704608,705648,665200,675199,672946,685691,707231,708077,673648,662939,665601,678253,664915,663939,680357,682228,676623,673265,677103,677937,660728,685185,669320,685282,683846,676355,666056,665799,665843,665855,665863,678328,670744,680955,673220,683792,683377,683331,660248,673945,681087,674061,672087,676120,676190,683164,670222,676493,676506,673631,673635,673664,673226,669050,669067,668536,667964,668182,668185,683713,667962,707673,661203,675673,671406,669885,680883,664315,665692,612993,682418,682729,682798,681478,681479,667853,667865,667874,667882,667904,667911,660479,674223,663316,667077,682435,667887,668816,673215,673217,679420,679480,685913,694526,695678,687571,699953,703749,703497,704703,705701,707894,677879,676367,690356,690975,691377,699752,697417,698453,702210,683339,673946,697902,672954,672969,697982,693773,681795,678616,704604,705905,683046,690272,701164,697844,690821,664904,664905,672953,672976,691549,687667,662492,682606,678681,690966,662070,668969,664913,673743,691921,662746,666422,666428,668975,687287,672009,702938,703709,679942,680075,684372,668978,677950,680203,677996,685423,686835,687070,665602,676842,679943,686115,678071,678003,667674,669568,677814,669271,684902,662437,668235,680849,682666,664530,670324,669652,669055,672795,660903,660909,667836,667837,667909,665689,665698,674226,681355,680702,700648,676714,667876,675876,684240,680264,669005,666121,665800,665810,665852,683960,676869,684031,673636,665849,663873,701943,676504,673684,684837,667922,667924,667946,667947,668013,668184,668269,671178,669088,676993,672534,673056,673280,670561,679388,681721,668971,676270,697269,667957,697624,689465,695391,671740,700194,673767,662079,691144,686152,691898,676311,690974,673773,673794,694268,703998,702208,701208,698635,700452,703476,686736,671367,665608,665656,696942,673408,706998,668270,673396,662807,678066,678067,678170,685809,699024,697265,697016,693516,707169,704877,699271,665603,665605,679666,680133,684592,669250,679096,679286,676516,707520,707936,671577,670014,665906,675055,675562,677978,677987,677991,702934,702319,687007,671969,679702,690199,677637,691442,668976,676038,678241,662855,667517,667681,673716,682199,677360,677722,677912,673902,675159,672515,673448,685110,684817,694581,672385,673234,662080,672966,672951,673010,672396,672082,662440,681352,676113,683136,681265,671041,678724,664707,684020,684037,676861,676901,668546,667760,683196,667897,667111,667995,684163,676499,676511,695245,673627,667942,667944,667951,667983,668118,685949,669089,669243,678413,678453,674341,679418,680513,680854,676697,676702,664294,670443,680555,682712,682912,682975,672849,660808,667849,667850,667878,667916,667918,665691,665702,674236,680617,680683,681979,673016,673103,684684,679398,696483,702331,695561,676306,693708,696593,671688,686241,697522,697984,708415,667051,669854,668262,681018,663518,663525,697252,685790,696998,696081,698372,703434,705815,694814,706807,702334,705521,671841,673249,684243,691224,698638,683278,662838,695157,692698,695513,675010,678070,663761,693697,678059,689271,695579,707183,703477,702475,668174,695626,686582,694180,689523,672640,689331,682034,679768,680051,660896,693686,690265,665850,663072,666727,670056,664906,664910,665061,683324,675065,675244,702333,672652,679789,680168,690031,684450,697068,673644,664625,673407,684878,676259,680807,675150,664135,667591,672721,695492,668508,696042,682134,685211,677278,677850,685157,685180,677905,685424,682350,669377,670612,684821,681290,673947,673988,668532,674148,672977,672986,662126,681399,672083,667899,675722,711067,665813,665842,665845,665851,665868,662943,668260,675832,676961,695573,661607,662150,676488,668538,669715,668188,675674,675675,695393,692204,684735,662438,674329,629884,680930,662216,670721,664638,664715,664287,664288,664358,682554,682605,682801,658171,663343,683512,674373,667835,667855,665703,665709,681525,681602,673043,673125,673325,673394,668618,683500,681748,681763,665167,659649,693602,701831,694271,696411,692089,687672,693340,697454,695985,699072,698795,697133,703469,691087,677013,676272,696623,691244,705729,666427,699709,705747,695454,694840,710161,672053,672055,672063,693777,671511,674803,675156,675197,677994,675471,667325,697880,698657,700646,666443,685551,685674,691897,704378,702307,690907,706087,699711,686628,671379,671392,672655,689338,702310,662725,663046,680766,679034,664256,701162,685877,675158,675168,677993,695302,696951,701410,686888,671851,683607,668990,663160,695653,667901,703432,662866,693784,673013,674072,663998,664001,664096,667929,701523,706199,676717,677731,672528,670439,685288,684933,660403,661605,668183,674019,672955,672961,678635,678700,676101,676203,683178,683476,665797,665859,678366,683956,678429,680562,667905,680282,680287,667112,674405,664290,680950,680959,680961,680962,676508,676509,673632,673637,673638,684840,667938,668178,671235,672519,675697,680880,665219,664639,676713,682362,682911,672767,672908,683768,667852,667888,665693,674192,681526,680517,673042,673340,668718,679463,679484,681708,697285,695581,676368,697369,696406,694783,690227,673344,678836,668264,671763,702335,674065,663642,663678,663749,695494,694989,694162,704817,704010,704798,693790,690231,694152,701464,686925,679963,679986,684565,671683,691329,683268,663009,675364,675579,678216,696156,691090,684168,705185,701080,696358,693780,696003,671843,671853,671928,671971,691353,696355,701480,693453,669251,672152,703708,662728,668920,698983,664924,677992,679970,668917,664624,675048,675436,677988,674470,668812,667680,676135,680848,685286,662252,672306,664286,677546,664504,663854,673264,684915,685281,685287,685348,677213,672932,673962,674538,669045,674144,672957,672970,672971,672389,672391,672080,678617,658982,666018,666122,662848,665848,665857,676951,660895,661816,672453,660927,690898,668897,661812,683372,683388,680284,669126,670140,660625,680525,683570,667926,667960,667996,682068,676496,677638,675721,665910,680892,664636,664292,673127,664029,682972,658980,659645,672920,667854,673087,667846,667871,667910,665694,665711,674224,667053,668165,673097,673347,673176,673214,673223,684727,681747,699325,693098,676285,693782,699641,692733,701575,671046,705505,707841,703748,685566,685607,684535,676608,689533,681961,710158,705715,705184,703269,700768,708545,686764,671852,678756,672634,671208,671233,662726,673470,678058,673275,662521,680806,697924,705718,663677,702445,685650,663760,703617,699857,702444,706559,686548,686558,686767,699970,696714,665655,689273,684281,684446,693793,673186,704470,666245,679033,670019,665598,675075,678051,678056,678062,678065,700670,684257,684388,681834,662934,670582,677997,678130,683299,664066,675031,672726,669008,666757,677858,682284,677717,677738,677849,673987,684966,683847,698918,672386,673937,668540,672078,678684,664759,666123,665802,665811,665853,665860,665865,665805,675866,673172,660906,670113,670221,670234,671145,676497,673677,667956,667984,668014,683673,668124,672535,675689,662433,674342,680884,676715,676721,676723,674572,669606,672848,672894,667893,667919,666870,681378,681413,681416,674481,667055,686756,673398,673404,673387,673401,668570,668876,670572) ;;

  # get list of students on course
  join: roster {
    fields: [roster.dropped]
    from: roster_extended
    sql_on: ${dim_section.section_id} = ${roster.section} ;;
    relationship: one_to_many
  }

  # get user details
  join: users {
    fields: [users.user_id, users.sso_guid, login_recency, users.usercount]
    from: users_extended
    sql_on: ${roster.user} = ${users.id} ;;
    relationship: many_to_one
  }

  # get list of assignments on course
  join: dim_deployment {
    fields: [dim_deployment.due_et_raw, dim_deployment.count, dim_deployment.relative_week]
    view_label: "Assignment"
    sql_on: ${dim_section.section_id} = ${dim_deployment.section_id};;
    relationship: one_to_many
  }

  join: dim_assignment {
    view_label: "Assignment"
    sql_on: ${dim_deployment.dim_assignment_id} = ${dim_assignment.dim_assignment_id};;
    relationship: many_to_one
  }

  # get list of questions on this assignment
  join: assignment_questions {
    sql_on: ${dim_assignment.assignment_id} = ${assignment_questions.assignment_id};;
    relationship: one_to_many
  }
  # additional question info
  join: dim_question {
    view_label: "Question"
    sql_on: ${assignment_questions.question_id} = ${dim_question.question_id} ;;
    relationship: many_to_one
  }

# get gradebook data
  join: gbcolumns {
    view_label: "Gradebook"
    fields: []
    sql_on: ${dim_section.section_id} = ${gbcolumns.section} ;;
    relationship: many_to_one
  }
  join: gradebook {
    view_label: "Gradebook"
    sql_on: ${users.user_id} = ${gradebook.user}
      and  ${gbcolumns.gbcolid} = ${gradebook.gbcolid};;
    relationship: many_to_one
  }
  join: categories {
    fields: []
    view_label: "Gradebook"
    sql_on: ${gbcolumns.col} = ${categories.id} ;;
    relationship: many_to_one
  }

}

explore: student_metrics {
  extends: [sections_students_assignments]

  join: class_weekly_stats {
    sql_on: ${dim_section.section_id} = ${class_weekly_stats.section_id} ;;
    relationship: one_to_many
  }

  #join: class_assignment_stats {}

  join: student_weekly_stats {
    sql_on: ${dim_section.section_id} = ${student_weekly_stats.section_id}
          and ${users.user_id} = ${student_weekly_stats.user_id}
          and ${class_weekly_stats.relative_week} = ${student_weekly_stats.relative_week} ;;
    relationship: one_to_many
  }
}

explore: sections {
  extends: [sections_students_assignments]

  # get student results - assignment level
  join: assignment_final {
    view_label: "Result Summary - Assignment"
    sql_on: ${roster.user} = ${assignment_final.userid}
      and ${dim_deployment.deployment_id} = ${assignment_final.deployment_id} ;;
    relationship: one_to_many
  }

  # get student results - question level - final attempt
  join: responses_final {
    view_label: "Result Summary - Question"
    sql_on: ${roster.user} = ${responses_final.userid}
      and ${dim_deployment.deployment_id} = ${responses_final.deployment_id}
      and ${dim_question.question_id} = ${responses_final.questionid}
      and ${assignment_questions.box_num} = ${responses_final.boxnum};;
    relationship: one_to_many
  }

  # get student results - question level - all attempts
  join: responses {
    view_label: "Result Summary - All Attempts"
    sql_on: ${responses_final.userid} = ${responses.userid}
      and ${responses_final.deployment_id} = ${responses.deployment_id}
      and ${responses_final.questionid} = ${responses.questionid}
      and ${responses_final.boxnum} = ${responses.boxnum};;
    relationship: one_to_many
  }



#   # get gradebook data
#   join: gbcolumns {
#     view_label: "Gradebook"
#     fields: []
#     sql_on: ${dim_section.section_id} = ${gbcolumns.section} ;;
#     relationship: many_to_one
#   }
#   join: gradebook {
#     view_label: "Gradebook"
#     sql_on: ${responses.userid} = ${gradebook.user}
#       and  ${gbcolumns.gbcolid} = ${gradebook.gbcolid};;
#     relationship: many_to_one
#   }
#   join: categories {
#     fields: []
#     view_label: "Gradebook"
#     sql_on: ${gbcolumns.col} = ${categories.id} ;;
#     relationship: many_to_one
#   }

}
